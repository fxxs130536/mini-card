{"version":3,"sources":["webpack:///./src/pages/chat/main.js","webpack:///./src/pages/chat/index.vue","webpack:///./src/pages/chat/index.vue?de37","webpack:///src/pages/chat/index.vue","webpack:///./src/common/api.js","webpack:///./src/mocks/history.js","webpack:///./src/mocks/reply.js","webpack:///./src/pages/chat/index.vue?8b69","webpack:///./src/mocks/contact.js","webpack:///./src/common/global.js"],"names":["app","$mount","config","enablePullDownRefresh","navigationBarTitleText","getRandomReply","id","template","m_reply","index","Math","random","length","resolve","reject","setTimeout","getContact","getUserInfo","cache","global","wxapi","login","then","res","console","log","setUserInfo","userInfo","catch","getHistory","history","getStorageSync","sorted","sort","a","b","time","leftJoin","filter","v","from","to","getMessageList","distince","rst","forEach","indexOf","push","pmsg","msg","lastmsg","original","contacts","contactObj","name","icon","sendMsg","type","replyMsg","frm","sendImg","msgObj","Date","setStorage","key","data","img","clearMsg","clearStorage","users","charCodeAt","table","map","_contact","m_contacts","setContact","k","_userInfo"],"mappings":"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AJF;AAKX,aAAS,CAAC,YAAD,EAAe,iDAAf,CALE;AAMX,gBAAY,CAAC,kCAAD,CAND;AAOX,aAAS,CAAC,sDAAD,CAPE;AAQX,aAAS,CAAC,QAAD;AARE,CAAf,E;;;;;;;;ACAA,0BAA0B,aAAa,0BAA0B;AACjE;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,C;;;;;;;;AC7JA;;AAEA,IAAIC,QAAQ,CACV,EAAC/D,IAAI,QAAL,EAAegD,MAAM,IAArB,EADU,EAEV,EAAChD,IAAI,QAAL,EAAegD,MAAM,IAArB,EAFU,EAGV,EAAChD,IAAI,OAAL,EAAcgD,MAAM,IAApB,EAHU,EAIV,EAAChD,IAAI,QAAL,EAAegD,MAAM,IAArB,EAJU,EAKV,EAAChD,IAAI,OAAL,EAAcgD,MAAM,IAApB,EALU,EAMV,EAAChD,IAAI,OAAL,EAAcgD,MAAM,IAApB,EANU,EAOV,EAAChD,IAAI,UAAL,EAAiBgD,MAAM,IAAvB,EAPU,EAQV,EAAChD,IAAI,YAAL,EAAmBgD,MAAM,IAAzB,EARU,EASV,EAAChD,IAAI,SAAL,EAAgBgD,MAAM,IAAtB,EATU,EAUV,EAAChD,IAAI,UAAL,EAAiBgD,MAAM,KAAvB,EAVU,EAWV,EAAChD,IAAI,QAAL,EAAegD,MAAM,IAArB,EAXU,EAYV,EAAChD,IAAI,SAAL,EAAgBgD,MAAM,IAAtB,EAZU,EAaV,EAAChD,IAAI,SAAL,EAAgBgD,MAAM,IAAtB,EAbU,EAcV,EAAChD,IAAI,SAAL,EAAgBgD,MAAM,IAAtB,EAdU,EAeV,EAAChD,IAAI,QAAL,EAAegD,MAAM,IAArB,EAfU,EAgBV,EAAChD,IAAI,UAAL,EAAiBgD,MAAM,KAAvB,EAhBU,EAiBV,EAAChD,IAAI,OAAL,EAAcgD,MAAM,IAApB,EAjBU,EAkBV,EAAChD,IAAI,OAAL,EAAcgD,MAAM,KAApB,EAlBU,EAmBV,EAAChD,IAAI,UAAL,EAAiBgD,MAAM,IAAvB,EAnBU,EAoBV,EAAChD,IAAI,YAAL,EAAmBgD,MAAM,KAAzB,EApBU,EAqBV,EAAChD,IAAI,UAAL,EAAiBgD,MAAM,IAAvB,EArBU,EAsBV,EAAChD,IAAI,WAAL,EAAkBgD,MAAM,KAAxB,EAtBU,EAuBV,EAAChD,IAAI,YAAL,EAAmBgD,MAAM,KAAzB,EAvBU,EAwBV,EAAChD,IAAI,OAAL,EAAcgD,MAAM,IAApB,EAxBU,EAyBV,EAAChD,IAAI,WAAL,EAAkBgD,MAAM,KAAxB,EAzBU,EA0BV,EAAChD,IAAI,OAAL,EAAcgD,MAAM,IAApB,EA1BU,EA2BV,EAAChD,IAAI,SAAL,EAAgBgD,MAAM,IAAtB,EA3BU,EA4BV,EAAChD,IAAI,WAAL,EAAkBgD,MAAM,KAAxB,EA5BU,EA6BV,EAAChD,IAAI,cAAL,EAAqBgD,MAAM,KAA3B,EA7BU,EA8BV,EAAChD,IAAI,aAAL,EAAoBgD,MAAM,KAA1B,EA9BU,CAAZ;;AAiCAe,QAAQA,MAAMpC,IAAN,CAAW,UAACC,CAAD,EAAIC,CAAJ;AAAA,SAAUD,EAAE5B,EAAF,CAAKgE,UAAL,CAAgB,CAAhB,IAAqBnC,EAAE7B,EAAF,CAAKgE,UAAL,CAAgB,CAAhB,CAA/B;AAAA,CAAX,CAAR;;AAEA,IAAIC,QAAQF,MAAMG,GAAN,CAAU,UAACjC,CAAD,EAAO;AAC3B,SAAO;AACLe,UAAMf,EAAEe,IADH;AAELhD,QAAIiC,EAAEjC,EAFD;AAGLiD,UAAM;AAHD,GAAP;AAKD,CANW,CAAZ;AAOA,yDAAegB,KAAf,E;;;;;;;;;AC5CA;;AAEA,yDAAe;AACbvD,YADa,sBACDuB,CADC,EACE;AACb,QAAI,KAAKkC,QAAT,EAAmB;AACjB,aAAOlC,IAAI,KAAKkC,QAAL,CAAclC,CAAd,CAAJ,GAAuB,KAAKkC,QAAnC;AACD,KAFD,MAEO;AACL,UAAIpB,aAAa,EAAjB;AACAqB,MAAA,+DAAAA,CAAW7B,OAAX,CAAmB,UAACN,CAAD,EAAO;AACxBc,mBAAWd,EAAEjC,EAAb,IAAmBiC,CAAnB;AACD,OAFD;AAGA,WAAKkC,QAAL,GAAgBpB,UAAhB;AACA,aAAO,KAAKrC,UAAL,CAAgBuB,CAAhB,CAAP;AACD;AACF,GAZY;AAaboC,YAba,sBAaDC,CAbC,EAaErC,CAbF,EAaK;AAChB,QAAIA,CAAJ,EAAO;AACL,UAAI,KAAKkC,QAAT,EAAmB;AAAE,aAAKA,QAAL,CAAcG,CAAd,IAAmBrC,CAAnB;AAAsB,OAA3C,MAAiD;AAC/C,aAAKkC,QAAL,GAAgB,EAAhB;AACA,aAAKA,QAAL,CAAcG,CAAd,IAAmBrC,CAAnB;AACD;AACF,KALD,MAKO;AACL,WAAKkC,QAAL,GAAgBG,CAAhB;AACD;AACF,GAtBY;AAuBb3D,aAvBa,yBAuBE;AACb,WAAO,KAAK4D,SAAZ;AACD,GAzBY;AA0BbnD,aA1Ba,uBA0BAa,CA1BA,EA0BG;AACd,SAAKsC,SAAL,GAAiBtC,CAAjB;AACD;AA5BY,CAAf,E","file":"static/js/pages/chat/main.js","sourcesContent":["import Vue from 'vue'\r\nimport App from './index'\r\nconst app = new Vue(App)\r\napp.$mount()\r\nexport default {\r\n  config: {\r\n    enablePullDownRefresh: false,\r\n    navigationBarTitleText: '电子名片',\r\n    'usingComponents': {\r\n      'i-icon': '../../dist/icon/index'\r\n    }\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/chat/main.js","var disposed = false\nfunction injectStyle (ssrContext) {\n  if (disposed) return\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"minimize\\\":false,\\\"sourceMap\\\":false}!../../../node_modules/mpvue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-4dc50f08\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!px2rpx-loader?{\\\"baseDpr\\\":1,\\\"rpxUnit\\\":0.5}!postcss-loader?{\\\"sourceMap\\\":true}!sass-loader?{\\\"sourceMap\\\":false}!../../../node_modules/mpvue-loader/lib/selector?type=styles&index=0!./index.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/mpvue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/mpvue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/mpvue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-4dc50f08\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":\\\"src\\\",\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"}}!../../../node_modules/mpvue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-4dc50f08\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\nComponent.options.__file = \"src\\\\pages\\\\chat\\\\index.vue\"\nif (Component.esModule && Object.keys(Component.esModule).some(function (key) {return key !== \"default\" && key.substr(0, 2) !== \"__\"})) {console.error(\"named exports are not supported in *.vue files.\")}\nif (Component.options.functional) {console.error(\"[vue-loader] index.vue: functional components are not supported with templates, they should use render functions.\")}\n\n/* hot reload */\nif (module.hot) {(function () {\n  var hotAPI = require(\"vue-hot-reload-api\")\n  hotAPI.install(require(\"vue\"), false)\n  if (!hotAPI.compatible) return\n  module.hot.accept()\n  if (!module.hot.data) {\n    hotAPI.createRecord(\"data-v-4dc50f08\", Component.options)\n  } else {\n    hotAPI.reload(\"data-v-4dc50f08\", Component.options)\n  }\n  module.hot.dispose(function (data) {\n    disposed = true\n  })\n})()}\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/chat/index.vue\n// module id = 120\n// module chunks = 1","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/extract-text-webpack-plugin/dist/loader.js?{\"omit\":1,\"remove\":true}!./node_modules/vue-style-loader!./node_modules/css-loader?{\"minimize\":false,\"sourceMap\":false}!./node_modules/mpvue-loader/lib/style-compiler?{\"vue\":true,\"id\":\"data-v-4dc50f08\",\"scoped\":true,\"hasInlineConfig\":false}!./node_modules/px2rpx-loader?{\"baseDpr\":1,\"rpxUnit\":0.5}!./node_modules/postcss-loader/lib?{\"sourceMap\":true}!./node_modules/sass-loader/lib/loader.js?{\"sourceMap\":false}!./node_modules/mpvue-loader/lib/selector.js?type=styles&index=0!./src/pages/chat/index.vue\n// module id = 121\n// module chunks = 1","<!--  -->\r\n<template>\r\n  <div class='page app page_chat' @click=\"plus = false\" >\r\n    <scroll-view :style=\"{height:scrollHeight}\" :class=\"{ fixed: focus,scrollP: plus}\" class=\"chartboard\" :scroll-top=\"chatTop\" scroll-y id=\"scrollH\" scroll-into-view=\"scrBottom\">\r\n      <div id=\"chatScrollView\">\r\n          <div v-for=\"(item, index) in message\" :key=\"index\" class=\"chat-item\">\r\n        <view :class=\"[item.from === 'me' ? 'fromme' : 'other']\" class=\"msgarea\">\r\n          <image class=\"icon\" :src=\"item.icon\"></image>\r\n          <view class=\"msg\" v-if=\"item.type ==='text'\">{{item.msg}}</view>\r\n          <image  mode=\"widthFix\" class=\"msg-img\" v-else-if=\"item.type === 'images'\" :src=\"item.msg\" alt=\"\" @click=\"previewImage(item.msg)\"></image>\r\n          <view class=\"clearfix\"></view>\r\n        </view>\r\n      </div>\r\n      </div>\r\n      <div id=\"scrBottom\"></div>\r\n      \r\n    </scroll-view>\r\n  <div id=\"hei\"></div>\r\n    <view class=\"input shouw-plus\" :class=\"{plusShow: plus }\" >\r\n      <view class=\"input_layout\">\r\n        <image class=\"input_icon voice\" src=\"/../../static/assets/chat/voice.png\"></image>\r\n        <image class=\"input_icon face\" src=\"/../../static/assets/chat/face.png\"></image>\r\n        <image class=\"input_icon plus\" src=\"/../../static/assets/chat/plus.png\" @click.stop=\"plus = !plus\"></image>\r\n        <view :class=\"[readyToSend === '' ? 'hidden' : '']\" class=\"send\" @tap=\"send\">发送</view>\r\n        <input @input=\"input\" :value=\"readyToSend\" :class=\"[focusFlag ? 'focusFlag' : '']\" class=\"input_text\" @focus=\"focus\" @blur=\"blur\"\r\n          @type=\"input\"></input>\r\n      </view>\r\n      <view class=\"plus-cont p-x-3 p-y-2 fl\" @click.stop>\r\n          <div class=\"plus-items m-b-1 \">\r\n            <div class=\"plut-t border center-a\" @click=\"sendImg\">\r\n              <i-icon type=\"picture_fill\" size=\"28\" />\r\n            </div>\r\n            <p class=\"font-sub text-oh text-center plut-b\">照片</p>\r\n          </div>\r\n      </view>\r\n    </view>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import api from '@/common/api'\r\n  import global from '@/common/global'\r\nimport {\r\n    mapGetters,\r\n    mapActions\r\n  } from 'vuex'\r\n  export default {\r\n    data () {\r\n      return {\r\n        chatTop: 0,\r\n        scrollB: true,\r\n        scrollHeight: 0,\r\n        message: [\r\n        ],\r\n        focus: false,\r\n        focusFlag: false,\r\n        readyToSend: '',\r\n        to: '',\r\n        from: '',\r\n        current: {},\r\n        plus: false\r\n      }\r\n    },\r\n\r\n    components: {\r\n  \r\n    },\r\n\r\n    computed: {\r\n      ...mapGetters({\r\n        userInfo: 'userInfo'\r\n      })\r\n    },\r\n\r\n    mounted () {\r\n  \r\n    },\r\n    onLoad (p) {\r\n      var _this = this\r\n      let contact = global.getContact(p.id)\r\n      if (!contact) {\r\n        this.$router.back()\r\n        return\r\n      }\r\n      wx.setNavigationBarTitle({title: contact.name})\r\n\r\n      this.loadMessage(p.id)\r\n      // this.bottom()\r\n      this.to = p.id\r\n    },\r\n\r\n    methods: {\r\n      async loadMessage (id) {\r\n        var _this = this\r\n        let userinfo, message\r\n        try {\r\n          userinfo = await api.getUserInfo()\r\n        } catch (e) {\r\n          console.log(e)\r\n          userinfo = {\r\n            nickName: 'Gcaufy',\r\n            id: 'gcaufy'\r\n          }\r\n        }\r\n        this.current = userinfo\r\n        // console.log(userinfo)\r\n        try {\r\n          message = await api.getHistory(id)\r\n  \r\n          // console.log(this.message)\r\n        } catch (e) {\r\n          message = null\r\n          console.error('getHistory fail')\r\n          console.log(e)\r\n        }\r\n  \r\n        if (message) {\r\n          this.message = message\r\n  \r\n          this.to = id\r\n          this.message.forEach((msg) => {\r\n            if (msg.from === 'me') {\r\n              msg.name = userinfo.nickName\r\n              msg.icon = userinfo.avatarUrl\r\n              // console.log(msg)\r\n            }\r\n          })\r\n        }\r\n        setTimeout(function () {\r\n          _this.bottom()\r\n        }, 800)\r\n      },\r\n      async send (evt) {\r\n        const msg = this.readyToSend\r\n        if (msg) {\r\n          let id = this.to\r\n          let msgObj = await api.sendMsg(id, msg)\r\n\r\n          msgObj.name = this.current.nickName\r\n          msgObj.icon = this.current.avatarUrl\r\n          this.message.push(msgObj)\r\n          this.bottom()\r\n          this.clear()\r\n\r\n          let randomReply = await api.getRandomReply(id)\r\n          this.replyMessage(randomReply)\r\n        }\r\n      },\r\n      async replyMessage (msg) {\r\n        let id = this.to\r\n        // console.log(id)\r\n        let contact = global.getContact(id)\r\n        // console.log(contact)\r\n        let msgObj = await api.replyMsg(id, msg)\r\n        msgObj.name = contact.name\r\n        msgObj.icon = contact.icon\r\n\r\n        this.message.push(msgObj)\r\n        this.bottom()\r\n      },\r\n      sendImg () {\r\n        var that = this\r\n        this.$wxapi.chooseImage({\r\n          count: 1, // 默认9\r\n          sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有\r\n          sourceType: ['album', 'camera']\r\n        }).then(async function (res) {\r\n          // debugger\r\n          let tempFilePaths = res.tempFilePaths\r\n          let id = that.to\r\n          console.log(id)\r\n          let msgObj = await api.sendImg(id, tempFilePaths[0])\r\n          msgObj.name = that.current.nickName\r\n          msgObj.icon = that.current.avatarUrl\r\n          that.message.push(msgObj)\r\n          that.plus = false\r\n  \r\n          setTimeout(function () {\r\n            that.bottom()\r\n          }, 100)\r\n          var data = {\r\n            id: id\r\n          }\r\n  \r\n          // wx.uploadFile({\r\n          //   url: 'pg.php/ZXinfo/session_submit', // 提交信息至后台\r\n          //   filePath: tempFilePaths[0],\r\n          //   name: 'content', // 文件对应的参数名字(key)\r\n          //   formData: data, // 其它的表单信息\r\n          //   success: function (res) {\r\n          //     var a = true\r\n          //     that.loaddata(a)\r\n          //     message = ''\r\n          //   }\r\n          // })\r\n        })\r\n      },\r\n      previewImage (path) {\r\n        let imgArr = this.message.filter((v) => v.type === 'images')\r\n        imgArr = imgArr.map(item => item.msg)\r\n        this.$wxapi.previewImage({\r\n          current: path, // 当前显示图片的http链接\r\n          urls: imgArr // 需要预览的图片http链接列表\r\n        }).then(res => {\r\n\r\n        })\r\n      },\r\n      input (evt) {\r\n        this.readyToSend = evt.mp.detail.value\r\n      },\r\n      focus (evt) {\r\n        this.focusFlag = true\r\n        this.focus = this.focusFlag\r\n        this.bottom()\r\n      },\r\n      blur (evt) {\r\n        this.focusFlag = false\r\n        this.focus = this.focusFlag\r\n      },\r\n      clear () {\r\n        this.readyToSend = ''\r\n      },\r\n      bottom () {\r\n        var _this = this\r\n        let scrollHeight = wx.getSystemInfoSync().windowHeight\r\n        this.scrollHeight = scrollHeight + 'px'\r\n        var query = wx.createSelectorQuery()\r\n        query.select('#chatScrollView').boundingClientRect()\r\n        query.selectViewport().scrollOffset()\r\n        query.exec(function (res) {\r\n          // console.log(res[0].height - scrollHeight)\r\n          _this.chatTop = (res[0].height - scrollHeight) < 0 ? 999999999 : res[0].height - scrollHeight + 1000\r\n          if ((res[0].height - scrollHeight) < 0) {\r\n            wx.pageScrollTo({\r\n              scrollTop: 999999999,\r\n              duration: 300\r\n            })\r\n          }\r\n        })\r\n      },\r\n      openPlus () {\r\n        this.plus = !this.plus\r\n      }\r\n    }\r\n  }\r\n</script>\r\n<style lang='scss' scoped>\r\n  .page_chat {\r\n    height: 100%;\r\n    background-color: #ededed;\r\n  }\r\n\r\n  $fontcolor: #7b7b7b;\r\n  $activecolor: #13b113;\r\n   \r\n  .chartboard {\r\n    background-color: #ededed;\r\n    height: 100%;\r\n    padding-bottom: 120rpx;\r\n    box-sizing: border-box;\r\n    &.fixed {\r\n      position: fixed;\r\n      left: 0;\r\n      right: 0;\r\n      overflow-y: scroll;\r\n    }\r\n    .msgarea {\r\n      padding: 20rpx 10rpx;\r\n      .clearfix:after {\r\n        content: \".\";\r\n        display: block;\r\n        height: 0;\r\n        clear: both;\r\n        visibility: hidden;\r\n      }\r\n      .clearfix {\r\n        height: 1%;\r\n      }\r\n      .msg {\r\n        border: 1px solid #d8d8d8;\r\n        font-size: 32rpx;\r\n        display: inline-block;\r\n        padding: 14rpx 20rpx;\r\n        max-width: 450rpx;\r\n        border-radius: 15rpx;\r\n      }\r\n       .msg-img{\r\n        display: flex;\r\n        max-width: 120px;\r\n        height: auto; \r\n        border: 1px solid #d8d8d8;\r\n        \r\n      }\r\n      .icon {\r\n        width: 70rpx;\r\n        height: 70rpx;\r\n      }\r\n      &.fromme {\r\n        .msg {\r\n          background-color: #9fe757;\r\n          float: right;\r\n          margin-right: 10rpx;\r\n        }\r\n        .msg-img{\r\n          float: right;\r\n          margin-right: 10rpx;\r\n        }\r\n        .icon {\r\n          float: right;\r\n          margin-right: 10rpx;\r\n        }\r\n      }\r\n      &.other {\r\n          .msg-img{\r\n             float: left;\r\n          margin-left: 10rpx;\r\n          }\r\n        .msg {\r\n          background-color: #fff;\r\n          float: left;\r\n          margin-left: 10rpx;\r\n        }\r\n        .icon {\r\n          float: left;\r\n          margin-left: 10rpx;\r\n        }\r\n      }\r\n    }\r\n  }\r\n.chartboard.scrollP{padding-bottom: 156px;}\r\n  .input {\r\n   transition: all 0.2s;\r\n\r\n    color: $fontcolor;\r\n    position: fixed;\r\n    bottom: 0;\r\n    height: 100rpx;\r\n    width: 100%;\r\n    border-top: 1px solid #d8d8d8;\r\n    background-color: #ededed;\r\n    font-size: 22rpx;\r\n    .input_layout {\r\n      position: relative;\r\n      .input_icon {\r\n        position: absolute;\r\n        width: 90rpx;\r\n        height: 90rpx;\r\n        &.voice {\r\n          left: 20rpx;\r\n        }\r\n        &.face {\r\n          right: 120rpx;\r\n        }\r\n        &.plus {\r\n          right: 20rpx;\r\n        }\r\n      }\r\n      .input_text {\r\n        border-bottom: 1px solid #d8d8d8;\r\n        margin-left: 120rpx;\r\n        margin-right: 240rpx;\r\n        height: 80rpx;\r\n        font-size: 32rpx;\r\n        color: #000;\r\n        &.focus {\r\n          border-bottom: 1px solid #9bb793;\r\n        }\r\n      }\r\n      .send {\r\n        background-color: #14b012;\r\n        display: inline-block;\r\n        box-sizing: border-box;\r\n        position: absolute;\r\n        border: 1px solid #378c37;\r\n        border-radius: 5rpx;\r\n        right: 20rpx;\r\n        width: 90rpx;\r\n        height: 74rpx;\r\n        line-height: 72rpx;\r\n        color: white;\r\n        text-align: center;\r\n        font-size: 30rpx;\r\n        margin-top: 8rpx;\r\n        &.hidden {\r\n          display: none;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .plus-cont{\r\n    width: 100%;\r\n    height: 96px;\r\n    background: #ededed;\r\n  }\r\n  .plus-items{\r\n    float: left;\r\n    width: calc((100% - 24px)/4);\r\n    height: 100%;\r\n    margin-left: 8px;\r\n    .plut-t{\r\n       height: 60px;\r\n       border-radius: 14px;     \r\n       border-color: #d8d8d8;\r\n    }\r\n    .plut-b{\r\n      width: 100%;\r\n    }\r\n  }\r\n  .plus-items:nth-child(4n + 1){\r\n    height: 20px;\r\n    line-height: 20px;\r\n    margin-left: 0;\r\n  }\r\n .plusShow{\r\n  height: 146px;\r\n }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/pages/chat/index.vue?5556eda0","import m_contacts from '../mocks/contact'\r\nimport m_history from '../mocks/history'\r\nimport m_reply from '../mocks/reply'\r\nimport global from './global'\r\n\r\nimport wxapi from 'minapp-api-promise'\r\n\r\nexport default {\r\n  getRandomReply (id) {\r\n    let template = m_reply[id]\r\n    if (!template) { template = m_reply['other'] }\r\n\r\n    let index = Math.random() * template.length >> 0\r\n\r\n    return new Promise((resolve, reject) => {\r\n      setTimeout(() => {\r\n        resolve(template[index])\r\n      })\r\n    })\r\n  },\r\n  getContact () {\r\n    return new Promise((resolve, reject) => {\r\n      setTimeout(() => {\r\n        resolve(m_contacts)\r\n      })\r\n    })\r\n  },\r\n\r\n  getUserInfo () {\r\n    return new Promise((resolve, reject) => {\r\n      let cache = global.getUserInfo()\r\n      if (cache) {\r\n        resolve(cache)\r\n      } else {\r\n        wxapi.login().then((res) => {\r\n          wxapi.getUserInfo().then((res) => {\r\n            console.log('getuserinfo success')\r\n            console.log(res)\r\n            global.setUserInfo(res.userInfo)\r\n            resolve(res.userInfo)\r\n          }).catch(reject)\r\n        }).catch(reject)\r\n      }\r\n    })\r\n  },\r\n\r\n  // select * from history h\r\n  // left join contact c\r\n  // on (h.from == c.id or h.to == c.id)\r\n  // where h.from = :id or h.to = :id or :id = '';\r\n  // order by h.time asc;\r\n  getHistory (id) {\r\n    let history = wxapi.getStorageSync('_wechat_history_') || m_history\r\n    return new Promise((resolve, reject) => {\r\n      setTimeout(() => {\r\n        let sorted = history.sort((a, b) => a.time - b.time)\r\n        if (!id) { resolve(this.leftJoin(sorted, m_contacts)) } else {\r\n          resolve(this.leftJoin(sorted.filter((v) => v.from === id || v.to === id), m_contacts))\r\n        }\r\n      })\r\n    })\r\n  },\r\n  // select *, (select msg from history h2 where h2.from = c.id or h2.to = c.id order by time desc limit 1) as lastmsg\r\n  // from history h\r\n  // left join contact c\r\n  // on (h.from == c.id or h.to == c.id)\r\n  // where h.from = :id or h.to = :id or :id = '';\r\n  // order by h.time desc;\r\n  getMessageList () {\r\n    let history = wxapi.getStorageSync('_wechat_history_') || m_history\r\n    return new Promise((resolve, reject) => {\r\n      let distince = []\r\n      let rst = []\r\n      let sorted = history.sort((a, b) => b.time - a.time)\r\n      sorted.forEach((v) => {\r\n        if (v.from !== 'me' && distince.indexOf(v.from) === -1) {\r\n          distince.push(v.from)\r\n        }\r\n        if (v.to !== 'me' && distince.indexOf(v.to) === -1) {\r\n          distince.push(v.to)\r\n        }\r\n      })\r\n\r\n      distince.forEach((v) => {\r\n        let pmsg = sorted.filter((msg) => msg.to === v || msg.from === v)\r\n        let lastmsg = pmsg.length ? pmsg[0].msg : ''\r\n\r\n        rst.push({\r\n          id: v,\r\n          lastmsg: lastmsg\r\n        })\r\n      })\r\n\r\n      setTimeout(() => {\r\n        resolve(this.leftJoin(rst, m_contacts))\r\n      })\r\n    })\r\n  },\r\n\r\n  leftJoin (original, contacts) {\r\n    let contactObj = global.getContact()\r\n    let rst = []\r\n\r\n    original.forEach((v) => {\r\n      if (!v.id) {\r\n        v.id = (v.from !== 'me') ? v.from : v.to\r\n      }\r\n      if (v.id) {\r\n        if (v.id !== 'me') {\r\n          v.name = contactObj[v.id].name\r\n          v.icon = 'https://i.loli.net/2017/08/21/599a521472424.jpg'\r\n        }\r\n        rst.push(v)\r\n      }\r\n    })\r\n    return rst\r\n  },\r\n\r\n  sendMsg (to, msg, type = 'text') {\r\n    return this.msg('me', to, msg, type)\r\n  },\r\n\r\n  replyMsg (frm, msg, type = 'text') {\r\n    return this.msg(frm, 'me', msg, type)\r\n  },\r\n  sendImg (to, msg, type = 'images') {\r\n    return this.msg('me', to, msg, type)\r\n  },\r\n  msg (frm, to, msg, type) {\r\n    let history = wxapi.getStorageSync('_wechat_history_') || m_history\r\n    let msgObj = {\r\n      to: to,\r\n      msg: msg,\r\n      type: type,\r\n      from: frm,\r\n      time: +new Date()\r\n    }\r\n\r\n    history.push(msgObj)\r\n\r\n    return new Promise((resolve, reject) => {\r\n      wxapi.setStorage({key: '_wechat_history_', data: history}).then(() => {\r\n        resolve(msgObj)\r\n      }).catch(reject)\r\n    })\r\n  },\r\n  img (frm, to, msg, type = 'images') {\r\n    let history = wxapi.getStorageSync('_wechat_history_') || m_history\r\n    let msgObj = {\r\n      to: to,\r\n      msg: msg,\r\n      type: type,\r\n      from: frm,\r\n      time: +new Date()\r\n    }\r\n\r\n    history.push(msgObj)\r\n\r\n    return new Promise((resolve, reject) => {\r\n      wxapi.setStorage({key: '_wechat_history_', data: history}).then(() => {\r\n        resolve(msgObj)\r\n      }).catch(reject)\r\n    })\r\n  },\r\n  clearMsg (id) {\r\n    return wxapi.clearStorage()\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/common/api.js","export default [\r\n    {'to': 'mahuateng', 'from': 'me', 'type': 'text', 'msg': '小马哥，我穷', 'time': 1480338091374},\r\n    {'to': 'me', 'from': 'mahuateng', 'type': 'text', 'msg': '300股，接着。', 'time': 1480338091375},\r\n    {'to': 'dinglei', 'from': 'me', 'type': 'text', 'msg': '为什么你们家的猪那么贵。', 'time': 1480338091378},\r\n    {'to': 'me', 'from': 'dinglei', 'type': 'text', 'msg': '因为他会飞。', 'time': 1480338091379},\r\n    {'to': 'mayun', 'from': 'me', 'type': 'text', 'msg': '支付鸨，挺好。', 'time': 1480338091384},\r\n    {'to': 'me', 'from': 'mayun', 'type': 'text', 'msg': '你懂的，嘿嘿。', 'time': 1480338091394},\r\n];\n\n\n// WEBPACK FOOTER //\n// ./src/mocks/history.js","export default {\r\n    'huangshang': ['朕公务繁忙，爱卿请自便。', '大胆!', '朕待你不薄 你为何要这样对朕?', '朕的后宫怎能容下你这样的女人'],\r\n    'huanghou': ['臣妾虽为皇后，也是皇上的妻子，身为人妻，侍奉夫君。', '臣妾做不到啊!'],\r\n    'erkang': ['我鼻孔真的很大吗？', '对不起，我错了，我不该和她看雪，看月亮，从诗词歌赋谈到人生哲学。我以后只和你看雪，看月亮，从诗词歌赋谈到人生哲学。'],\r\n    'xiaoyanzi': ['门前一只狗，在啃肉骨头，又来一只狗，双双打破头。', '人之初，性本善，性相近，习相远……狗不叫，猫不跳，鸡不飞，猪不闹……爹不疼，娘不要……'],\r\n    'ziwei': ['尔康……你好过分哦!', '你和她看雪，看月亮，从诗词歌赋谈到人生哲学，我都没有和你看雪，看月亮，从诗词歌赋谈到人生哲学。'],\r\n    'xiaojian': ['一箫一剑走江湖，千古情愁酒一壶!两脚踏翻尘世路，以天为盖地为庐!'],\r\n    'wuage': ['小燕子，我真的好喜欢你 不管是那个刁蛮任性的你 活泼可爱的你 还是现在这个楚楚可怜的你 我都好喜欢好喜欢'],\r\n    'other': ['休要调戏我。'],\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/mocks/reply.js","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;\n  return _c('div', {\n    staticClass: \"page app page_chat\",\n    attrs: {\n      \"eventid\": '6'\n    },\n    on: {\n      \"click\": function($event) {\n        _vm.plus = false\n      }\n    }\n  }, [_c('scroll-view', {\n    staticClass: \"chartboard\",\n    class: {\n      fixed: _vm.focus, scrollP: _vm.plus\n    },\n    style: ({\n      height: _vm.scrollHeight\n    }),\n    attrs: {\n      \"scroll-top\": _vm.chatTop,\n      \"scroll-y\": \"\",\n      \"id\": \"scrollH\",\n      \"scroll-into-view\": \"scrBottom\"\n    }\n  }, [_c('div', {\n    attrs: {\n      \"id\": \"chatScrollView\"\n    }\n  }, _vm._l((_vm.message), function(item, index) {\n    return _c('div', {\n      key: index,\n      staticClass: \"chat-item\"\n    }, [_c('view', {\n      staticClass: \"msgarea\",\n      class: [item.from === 'me' ? 'fromme' : 'other']\n    }, [_c('image', {\n      staticClass: \"icon\",\n      attrs: {\n        \"src\": item.icon\n      }\n    }), _vm._v(\" \"), (item.type === 'text') ? _c('view', {\n      staticClass: \"msg\"\n    }, [_vm._v(_vm._s(item.msg))]) : (item.type === 'images') ? _c('image', {\n      staticClass: \"msg-img\",\n      attrs: {\n        \"mode\": \"widthFix\",\n        \"src\": item.msg,\n        \"alt\": \"\",\n        \"eventid\": '0-' + index\n      },\n      on: {\n        \"click\": function($event) {\n          _vm.previewImage(item.msg)\n        }\n      }\n    }) : _vm._e(), _vm._v(\" \"), _c('view', {\n      staticClass: \"clearfix\"\n    })])])\n  })), _vm._v(\" \"), _c('div', {\n    attrs: {\n      \"id\": \"scrBottom\"\n    }\n  })]), _vm._v(\" \"), _c('div', {\n    attrs: {\n      \"id\": \"hei\"\n    }\n  }), _vm._v(\" \"), _c('view', {\n    staticClass: \"input shouw-plus\",\n    class: {\n      plusShow: _vm.plus\n    }\n  }, [_c('view', {\n    staticClass: \"input_layout\"\n  }, [_c('image', {\n    staticClass: \"input_icon voice\",\n    attrs: {\n      \"src\": \"/../../static/assets/chat/voice.png\"\n    }\n  }), _vm._v(\" \"), _c('image', {\n    staticClass: \"input_icon face\",\n    attrs: {\n      \"src\": \"/../../static/assets/chat/face.png\"\n    }\n  }), _vm._v(\" \"), _c('image', {\n    staticClass: \"input_icon plus\",\n    attrs: {\n      \"src\": \"/../../static/assets/chat/plus.png\",\n      \"eventid\": '1'\n    },\n    on: {\n      \"click\": function($event) {\n        $event.stopPropagation();\n        _vm.plus = !_vm.plus\n      }\n    }\n  }), _vm._v(\" \"), _c('view', {\n    staticClass: \"send\",\n    class: [_vm.readyToSend === '' ? 'hidden' : ''],\n    attrs: {\n      \"eventid\": '2'\n    },\n    on: {\n      \"tap\": _vm.send\n    }\n  }, [_vm._v(\"发送\")]), _vm._v(\" \"), _c('input', {\n    staticClass: \"input_text\",\n    class: [_vm.focusFlag ? 'focusFlag' : ''],\n    attrs: {\n      \"value\": _vm.readyToSend,\n      \"eventid\": '3'\n    },\n    on: {\n      \"input\": _vm.input,\n      \"focus\": _vm.focus,\n      \"blur\": _vm.blur,\n      \"type\": _vm.input\n    }\n  })]), _vm._v(\" \"), _c('view', {\n    staticClass: \"plus-cont p-x-3 p-y-2 fl\",\n    attrs: {\n      \"eventid\": '5'\n    },\n    on: {\n      \"click\": function($event) {\n        $event.stopPropagation();\n      }\n    }\n  }, [_c('div', {\n    staticClass: \"plus-items m-b-1 \"\n  }, [_c('div', {\n    staticClass: \"plut-t border center-a\",\n    attrs: {\n      \"eventid\": '4'\n    },\n    on: {\n      \"click\": _vm.sendImg\n    }\n  }, [_c('i-icon', {\n    attrs: {\n      \"type\": \"picture_fill\",\n      \"size\": \"28\",\n      \"mpcomid\": '0'\n    }\n  })], 1), _vm._v(\" \"), _c('p', {\n    staticClass: \"font-sub text-oh text-center plut-b\"\n  }, [_vm._v(\"照片\")])], 1)])])], 1)\n}\nvar staticRenderFns = []\nrender._withStripped = true\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\nif (module.hot) {\n  module.hot.accept()\n  if (module.hot.data) {\n     require(\"vue-hot-reload-api\").rerender(\"data-v-4dc50f08\", esExports)\n  }\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/mpvue-loader/lib/template-compiler?{\"id\":\"data-v-4dc50f08\",\"hasScoped\":true,\"transformToRequire\":{\"video\":\"src\",\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"}}!./node_modules/mpvue-loader/lib/selector.js?type=template&index=0!./src/pages/chat/index.vue\n// module id = 126\n// module chunks = 1","// import wepy from 'wepy';\r\n\r\nlet users = [\r\n  {id: 'caixia', name: '彩霞'},\r\n  {id: 'erkang', name: '尔康'},\r\n  {id: 'ertai', name: '尔泰'},\r\n  {id: 'fuheng', name: '傅恒'},\r\n  {id: 'fujin', name: '福晋'},\r\n  {id: 'fulun', name: '福伦'},\r\n  {id: 'huanghou', name: '皇后'},\r\n  {id: 'huangshang', name: '皇上'},\r\n  {id: 'jingsuo', name: '金锁'},\r\n  {id: 'laofuoye', name: '老佛爷'},\r\n  {id: 'linfei', name: '令妃'},\r\n  {id: 'liuhong', name: '柳红'},\r\n  {id: 'liuqing', name: '柳青'},\r\n  {id: 'mingyue', name: '明月'},\r\n  {id: 'qinger', name: '晴儿'},\r\n  {id: 'rongmeme', name: '蓉嚒嚒'},\r\n  {id: 'saiya', name: '塞雅'},\r\n  {id: 'wuage', name: '五阿哥'},\r\n  {id: 'xiangfei', name: '香妃'},\r\n  {id: 'xiaodengzi', name: '小邓子'},\r\n  {id: 'xiaojian', name: '萧剑'},\r\n  {id: 'xiaoyanzi', name: '小燕子'},\r\n  {id: 'xiaozhuozi', name: '小卓子'},\r\n  {id: 'ziwei', name: '紫薇'},\r\n  {id: 'mahuateng', name: '马化腾'},\r\n  {id: 'mayun', name: '马云'},\r\n  {id: 'dinglei', name: '丁磊'},\r\n  {id: 'liyanhong', name: '李彦宏'},\r\n  {id: 'liuqiangdong', name: '刘强东'},\r\n  {id: 'liuchuanzhi', name: '刘传志'}\r\n]\r\n\r\nusers = users.sort((a, b) => a.id.charCodeAt(0) - b.id.charCodeAt(0))\r\n\r\nlet table = users.map((v) => {\r\n  return {\r\n    name: v.name,\r\n    id: v.id,\r\n    icon: 'https://i.loli.net/2017/08/21/599a521472424.jpg'\r\n  }\r\n})\r\nexport default table\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/mocks/contact.js","import m_contacts from '../mocks/contact'\r\n\r\nexport default {\r\n  getContact (v) {\r\n    if (this._contact) {\r\n      return v ? this._contact[v] : this._contact\r\n    } else {\r\n      let contactObj = {}\r\n      m_contacts.forEach((v) => {\r\n        contactObj[v.id] = v\r\n      })\r\n      this._contact = contactObj\r\n      return this.getContact(v)\r\n    }\r\n  },\r\n  setContact (k, v) {\r\n    if (v) {\r\n      if (this._contact) { this._contact[k] = v } else {\r\n        this._contact = {}\r\n        this._contact[k] = v\r\n      }\r\n    } else {\r\n      this._contact = k\r\n    }\r\n  },\r\n  getUserInfo () {\r\n    return this._userInfo\r\n  },\r\n  setUserInfo (v) {\r\n    this._userInfo = v\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/common/global.js"],"sourceRoot":""}